Select distinct
Case when TAB_CASE.ID_NUMBER like 'Q%' then
substr(substr(TAB_CASE.ID_NUMBER,2,length(TAB_CASE.ID_NUMBER)),1,instr(substr(TAB_CASE.ID_NUMBER,2,length(TAB_CASE.ID_NUMBER)),'-',1,2)-1) 
when TAB_CASE.ID_NUMBER like 'SS%' 
then substr(TAB_CASE.ID_NUMBER,3,length(TAB_CASE.ID_NUMBER))
when TAB_CASE.ID_NUMBER like 'FER%' 
then substr(TAB_CASE.ID_NUMBER,4,length(TAB_CASE.ID_NUMBER))
else tab_case.id_number end as vf_order_ref,
BUS_ORG.NAME as Customer_Name,
Bus_Org.Org_Id as Customer_id,
FIN_ACCNT.NAME as FIN_ACCNT_NAMe,
FIN_ACCNT.X_ID as BIlling_Account_ID,
FIN_ACCNT.X_BILLING_SYSTEM as BILLING_SYSTEM,
SITE_PART.serial_no as Service_reference,
SITE_PART.instance_name as service_name,
TAB_CASE.ID_NUMBER as Case_Id,
TAB_CASE.creation_time as Case_Creation_date,
TABLE_CONDITION.title as Case_Condition,
TABLE_CLOSE_CASE.close_date,
ELM_CASE_STATUS.Title as Case_Status,
TAB_CASE.TITLE as Case_Title,
TABLE_CONTRACT.ID as Order_ID,
ORDER_CONDITION.TITLE as ORDER_CONDITION,
TABLE_CONTRACT.START_DATE as ORDER_START_DATE,
TABLE_CONTRACT.X_ORDER_SOURCE As ORDER_SOURCE,
TABLE_CONTRACT.X_PEA_CODE as PEA_CODE,
ELM_PRTY_STATUS.Title as Priority,
ELM_SVRTY_STATUS.TITLE as Severity,
TABLE_CONTRACT.X_PROJECT_FLAG as PROJ_FLAG,
TAB_PD_ORDER.X_DPO_PROJ_MGMT as DPO_Proj_Mgmt,
TAB_PD_ORDER.X_PLANNED_OUTAGE as Planned_Outage,
tab_contr_schedule.x_order_type as Order_Type,
TAB_PD_ORDER.X_CEASE_REF as Cease_Ref,
TAB_PD_ORDER.X_BILLING_ORDER_REF as Bill_Order_Ref,
TAB_PD_ORDER.X_CUSTOMER_REF as Customer_Ref,
TAB_CONTR_ITM.X_EXTERNAL_ORDER_ELEMENT as Ext_Order_Element,
TAB_CONTR_ITM.X_ARFS as ARFS,
TAB_CONTR_ITM.X_TRFS as TRFS,
TAB_EMPLOYEE.FIRST_NAME||' '||TAB_EMPLOYEE.LAST_NAME as case_owner,
TABLE_CONTRACT.X_CRD as CRD,
TAB_CONTR_ITM.X_CDD AS CDD,
TAB_CONTR_ITM.X_DELIVERY_METHOD as DELIVERY_METHOD,
LT.X_LEADTIME,
TAB_CASE.CASE_TYPE_LVL1 as Type_1,
TAB_CASE.CASE_TYPE_LVL2 as Type_2,
TAB_CASE.CASE_TYPE_LVL3 as Type_3,
SITE.NAME as Site_Name,
ADDRESS.ADDRESS,
ADDRESS.ADDRESS_2,
ADDRESS.X_ADDRESS_3,
ADDRESS.STATE,
ADDRESS.ZIPCODE
from
ods_cdc_clarify.O_CLARIFY_TAB_SITE_PART  SITE_PART,
ods_cdc_clarify.O_CLARIFY_TAB_CASE TAB_CASE,
ods_cdc_clarify.O_CLARIFY_TAB_CONTR_ITM TAB_CONTR_ITM,
ODS_CDC_CLARIFY.O_CLARIFY_TAB_CONTR_SCHDULE TAB_CONTR_SCHEDULE,
ODS_CDC_CLARIFY.O_CLARIFY_TABLE_CONDITION TABLE_CONDITION,
ODS_CDC_CLARIFY.O_CLARIFY_TAB_CLOSE_CASE TABLE_CLOSE_CASE,
ods_cdc_clarify.O_CLARIFY_TABLE_GBST_ELM ELM_CASE_Status,
ODS_CDC_CLARIFY.O_CLARIFY_TAB_CONTRACT Table_Contract,
ODS_CDC_CLARIFY.O_CLARIFY_TABLE_CONDITION ORDER_CONDITION,
ODS_CDC_CLARIFY.O_CLARIFY_TABLE_X_PD_ORDER TAB_PD_ORDER,
ods_cdc_clarify.O_CLARIFY_TAB_USER TAB_USER,
ods_cdc_clarify.O_CLARIFY_TAB_EMPLOYEE TAB_EMPLOYEE,
ODS_CDC_CLARIFY.O_CLARIFY_TAB_BUS_ORG BUS_ORG,
ods_cdc_clarify.O_CLARIFY_TABLE_FIN_ACCNT FIN_ACCNT,
ods_cdc_clarify.O_CLARIFY_TABLE_GBST_ELM ELM_PRTY_Status,
ods_cdc_clarify.O_CLARIFY_TABLE_GBST_ELM ELM_SVRTY_Status,
ODS_CDC_CLARIFY.O_CLARIFY_TABLE_SITE SITE,
ODS_CDC_CLARIFY.O_CLARIFY_TABLE_ADDRESS ADDRESS,
ODS_CDC_CLARIFY.TABLE_X_ARFS_ORD_LEADTIME LT,
(select * from ODS_CDC_CLARIFY.O_CLARIFY_TABLE_SIT_PRT_ROLE where ROLE_NAME='A-END')PRT_ROLE
where
TAB_CONTR_ITM.X_CONTR_ITM2CASE=TAB_CASE.OBJID
AND TAB_CONTR_ITM.CONTR_ITM2SITE_PART=SITE_PART.OBJID
AND TAB_CONTR_ITM.CONTR_ITM2CONTR_SCHEDULE=TAB_CONTR_SCHEDULE.OBJID
AND TABLE_CONDITION.OBJID=TAB_CASE.CASE_STATE2CONDITION
AND  TABLE_CLOSE_CASE.LAST_CLOSE2CASE(+)=TAB_CASE.OBJID
AND ELM_case_status.objid=tab_case.casests2gbst_elm
AND TAB_CONTR_SCHEDULE.SCHEDULE2CONTRACT=TABLE_CONTRACT.OBJID
AND Table_contract.contract2condition=order_condition.objid(+)
AND TAB_CONTR_ITM.X_CONTR_ITM2PROV_DATA_ORDER=TAB_PD_ORDER.OBJID(+)
AND TAB_USER.OBJID=TAB_CASE.CASE_OWNER2USER
AND TAB_USER.OBJID=TAB_EMPLOYEE.EMPLOYEE2USER
AND site_part.x_site_part2bus_org=bus_org.objid
AND BUS_ORG.objid = FIN_ACCNT.fa_child2bus_org
AND SITE_PART.X_SITE_PART2BILL_ACCNT=FIN_ACCNT.OBJID(+)
AND TAB_CASE.RESPPRTY2GBST_ELM=elm_prty_status.objid
AND TAB_CASE.RESPSVRTY2GBST_ELM=elm_SVRTY_status.objid
AND PRT_ROLE.PRT_ROLE2SITE=SITE.OBJID(+)
and PRT_ROLE.PRT_ROLE2SITE_PART=SITE_PART.objid
AND SITE.CUST_PRIMADDR2ADDRESS=ADDRESS.OBJID(+)
AND LT.OBJID(+)=TAB_CASE.X_CASE2ORD_LD_TM
AND upper(TABLE_CONDITION.title)!='CLOSED'